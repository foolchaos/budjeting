# Budget Requests App

Технологии: Java 21, Spring Boot 3.3, Vaadin 24, PostgreSQL, Maven, Docker.

## Запуск (Docker, production режим Vaadin)
```bash
docker compose up --build
```
Приложение будет доступно на http://localhost:8080

## Локальный запуск (dev)
1) Запустить PostgreSQL (например, через Docker) и выставить переменные окружения `APP_DB_URL`, `APP_DB_USER`, `APP_DB_PASS` при необходимости.
2) Запуск:
```bash
./mvnw spring-boot:run
```
или
```bash
mvn spring-boot:run
```

## Сборка prod-jar c фронтендом Vaadin
```bash
mvn -Pproduction clean package
```
Получится `target/budget-vaadin-app-0.1.0.jar`.

## Учет требований (кратко)
- Вкладки «Справочники» и «Заявки» (по умолчанию открыта «Справочники»).
- БДЗ: TreeGrid c чекбоксами у каждого узла, карточка сущности, CRUD.
- Прочие справочники: Grid + карточка сущности, CRUD, групповое удаление.
- «Заявки»: таблица с заданными колонками и фильтрами; карточка; мастер создания (3 шага).
- Каскадные удаления и «отвязка» заявок реализованы в сервисах удаления.

## Импорт ЦФО I из Excel
В разделе «Справочники» → «ЦФО I» доступна кнопка **Импорт**. Поддерживается загрузка файлов в формате `.xlsx`
со следующими ограничениями:

- размер файла — не более 10 МБ;
- не более 50 000 строк данных (заголовок не учитывается);
- обрабатывается только первый лист книги.

Структура листа строго фиксирована: первая строка — заголовок из двух столбцов «Код» и «Наименование»,
далее идут строки с данными. Код используется как уникальный идентификатор, поэтому при повторном импорте
с тем же кодом запись обновляется. Пустые строки допускаются и пропускаются. Пример содержимого файла:

| Код  | Наименование     |
|------|------------------|
| 1001 | Дирекция         |
| 1002 | Сбыт             |
| 2005 | Производство №1 |

Файл можно формировать как в Excel, так и в любом редакторе электронных таблиц, главное — сохранить его
в формате `.xlsx` с указанной структурой.

## Импорт ЦФО II из Excel
Раздел «Справочники» → «ЦФО II» также содержит кнопку **Импорт** для загрузки данных из файлов `.xlsx`.
Действуют те же ограничения по размеру и количеству строк (не более 10 МБ и 50 000 строк),
обрабатывается первый лист книги с заголовком «Код» и «Наименование». Код используется как уникальный
идентификатор, поэтому при повторной загрузке строка с тем же кодом обновляет существующую запись.

Пример таблицы для импорта ЦФО II:

| Код  | Наименование                |
|------|-----------------------------|
| 01   | Управление по региону Центр |
| 02   | Управление по региону Юг    |
| 10   | Управление по региону Восток |

## Импорт контрагентов из Excel
Раздел «Справочники» → «Контрагент» также содержит кнопку **Импорт**. Поддерживаются файлы формата `.xlsx`
с теми же ограничениями: размер не более 10 МБ, максимум 50 000 строк данных, обрабатывается только первый лист книги.

Первая строка листа должна содержать единственный столбец «Наименование юридического лица». Каждая последующая строка
описывает отдельного контрагента. Если в файле встречается имя, которое уже есть в базе, соответствующая запись будет
обновлена (значение заменится на то, что указано в файле). Пустые строки игнорируются. Пример файла импорта:

| Наименование юридического лица |
|--------------------------------|
| ООО «Альфа»                    |
| АО «Бета»                      |
| ИП Сидоров И.И.                |

## Импорт БДЗ из Excel
Для справочника «БДЗ» доступен аналогичный импорт из файлов `.xlsx`.
Действуют те же ограничения: размер файла не более 10 МБ, максимум 50 000 строк данных,
обрабатывается первый лист книги. Структура листа фиксирована четырьмя столбцами в первой строке:

1. «Код» — обязательный уникальный идентификатор записи БДЗ.
2. «Наименование» — обязательное название.
3. «Код ЦФО I» — необязательный код существующего ЦФО I (если указан, запись должна быть уже создана в справочнике ЦФО I).
4. «Код родителя» — необязательный код другого БДЗ, который будет назначен родителем. Можно ссылаться как на запись из базы,
   так и на другую строку того же файла (порядок строк произвольный).

Строки, в которых код и наименование пустые, игнорируются. Пример файла импорта:

| Код   | Наименование              | Код ЦФО I | Код родителя |
|-------|---------------------------|-----------|---------------|
| 1000  | Управление проектами      | 1001      |               |
| 1100  | Отдел внедрения           | 1001      | 1000          |
| 1200  | Отдел сопровождения       | 1002      | 1000          |

После успешного импорта новые и обновлённые записи сразу появляются в иерархии БДЗ.

## Импорт МВЗ из Excel
Справочник «МВЗ» также поддерживает загрузку данных из файлов `.xlsx`.
Ограничения совпадают с другими импортами: размер файла не более 10 МБ, до 50 000 строк данных,
обрабатывается только первый лист книги. Заголовок первой строки должен содержать столбцы
«Код», «Наименование», «Код ЦФО I».

1. «Код» — обязательный уникальный идентификатор МВЗ.
2. «Наименование» — обязательное поле с названием.
3. «Код ЦФО I» — необязательный код существующего ЦФО I. Если указан, соответствующая запись должна
   быть создана в справочнике «ЦФО I», иначе импорт завершится с ошибкой.

Строки, где все значения пустые, пропускаются. Пример файла:

| Код   | Наименование           | Код ЦФО I |
|-------|------------------------|-----------|
| 3000  | Производственный цех 1 | 1001      |
| 3100  | Складское хозяйство    | 1002      |
| 3200  | Ремонтная служба       |           |

После успешной загрузки новые и обновлённые записи становятся доступны в разделе «МВЗ».

## Импорт БО из Excel
Раздел «Справочники» → «БО» также поддерживает загрузку данных из файлов `.xlsx`.
Используются те же ограничения (не более 10 МБ, максимум 50 000 строк, обрабатывается первый лист).
Первая строка листа должна содержать заголовки «Код», «Наименование», «Код БДЗ».

- «Код» — обязательный уникальный идентификатор статьи БО;
- «Наименование» — обязательное поле с названием статьи;
- «Код БДЗ» — необязательный код существующего БДЗ (если указан, запись должна присутствовать в справочнике БДЗ и будет привязана к статье).

Строки, где все три значения пустые, пропускаются. Пример файла:

| Код  | Наименование               | Код БДЗ |
|------|----------------------------|---------|
| 5001 | Приобретение оборудования  | 1000    |
| 5002 | Расходы на маркетинг       | 1100    |
| 5003 | Резерв на командировки     |         |

После успешного импорта данные появляются в таблице БО и становятся доступными для дальнейшей работы.

## Импорт ЗГД из Excel
В разделе «Справочники» → «ЗГД» доступна кнопка **Импорт** для загрузки файлов формата `.xlsx`.
Применяются те же ограничения на размер (не более 10 МБ) и количество строк (до 50 000 записей данных),
обрабатывается только первый лист книги.

Строка заголовка должна содержать три столбца: «ФИО», «Департамент», «Код БДЗ».

1. «ФИО» — обязательное поле с полным именем ЗГД.
2. «Департамент» — обязательный столбец с наименованием подразделения.
3. «Код БДЗ» — необязательное значение кода существующего БДЗ. Если код указан, соответствующая запись
   должна уже присутствовать в справочнике БДЗ; иначе импорт остановится с ошибкой.

Файл обрабатывается построчно. Пустые строки пропускаются. ЗГД идентифицируется сочетанием ФИО и департамента:
если в базе уже есть запись с такими значениями, она будет обновлена, иначе будет создана новая.
Назначение БДЗ имеет ограничение «один к одному»: если в файле указать код БДЗ, который уже привязан к другому
ЗГД, во время импорта старая связь будет автоматически снята и БДЗ будет назначен новой записи.

Пример таблицы:

| ФИО                  | Департамент                | Код БДЗ |
|----------------------|----------------------------|---------|
| Иванов Иван Иванович | Управление продажами       | 1000    |
| Петров Пётр Петрович | Служба клиентского сервиса |         |
| Сидорова Анна Игоревна | Финансовый контроль      | 1200    |

После успешного импорта новые и обновлённые записи отображаются в справочнике ЗГД.
