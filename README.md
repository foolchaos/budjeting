# Budget Requests App

Технологии: Java 21, Spring Boot 3.3, Vaadin 24, PostgreSQL, Maven, Docker.

## Запуск (Docker, production режим Vaadin)
```bash
docker compose up --build
```
Приложение будет доступно на http://localhost:8080

## Локальный запуск (dev)
1) Запустить PostgreSQL (например, через Docker) и выставить переменные окружения `APP_DB_URL`, `APP_DB_USER`, `APP_DB_PASS` при необходимости.
2) Запуск:
```bash
./mvnw spring-boot:run
```
или
```bash
mvn spring-boot:run
```

## Сборка prod-jar c фронтендом Vaadin
```bash
mvn -Pproduction clean package
```
Получится `target/budget-vaadin-app-0.1.0.jar`.

## Учет требований (кратко)
- Вкладки «Справочники» и «Заявки» (по умолчанию открыта «Справочники»).
- БДЗ: TreeGrid c чекбоксами у каждого узла, карточка сущности, CRUD.
- Прочие справочники: Grid + карточка сущности, CRUD, групповое удаление.
- «Заявки»: таблица с заданными колонками и фильтрами; карточка; мастер создания (3 шага).
- Каскадные удаления и «отвязка» заявок реализованы в сервисах удаления.

## Импорт ЦФО I из Excel
В разделе «Справочники» → «ЦФО I» доступна кнопка **Импорт**. Поддерживается загрузка файлов в формате `.xlsx`
со следующими ограничениями:

- размер файла — не более 10 МБ;
- не более 50 000 строк данных (заголовок не учитывается);
- обрабатывается только первый лист книги.

Структура листа строго фиксирована: первая строка — заголовок из двух столбцов «Код» и «Наименование»,
далее идут строки с данными. Код используется как уникальный идентификатор, поэтому при повторном импорте
с тем же кодом запись обновляется. Пустые строки допускаются и пропускаются. Пример содержимого файла:

| Код  | Наименование     |
|------|------------------|
| 1001 | Дирекция         |
| 1002 | Сбыт             |
| 2005 | Производство №1 |

Файл можно формировать как в Excel, так и в любом редакторе электронных таблиц, главное — сохранить его
в формате `.xlsx` с указанной структурой.

## Импорт ЦФО II из Excel
Раздел «Справочники» → «ЦФО II» также содержит кнопку **Импорт** для загрузки данных из файлов `.xlsx`.
Действуют те же ограничения по размеру и количеству строк (не более 10 МБ и 50 000 строк),
обрабатывается первый лист книги с заголовком «Код» и «Наименование». Код используется как уникальный
идентификатор, поэтому при повторной загрузке строка с тем же кодом обновляет существующую запись.

Пример таблицы для импорта ЦФО II:

| Код  | Наименование                |
|------|-----------------------------|
| 01   | Управление по региону Центр |
| 02   | Управление по региону Юг    |
| 10   | Управление по региону Восток |

## Импорт БДЗ из Excel
Для справочника «БДЗ» доступен аналогичный импорт из файлов `.xlsx`.
Действуют те же ограничения: размер файла не более 10 МБ, максимум 50 000 строк данных,
обрабатывается первый лист книги. Структура листа фиксирована четырьмя столбцами в первой строке:

1. «Код» — обязательный уникальный идентификатор записи БДЗ.
2. «Наименование» — обязательное название.
3. «Код ЦФО I» — необязательный код существующего ЦФО I (если указан, запись должна быть уже создана в справочнике ЦФО I).
4. «Код родителя» — необязательный код другого БДЗ, который будет назначен родителем. Можно ссылаться как на запись из базы,
   так и на другую строку того же файла (порядок строк произвольный).

Строки, в которых код и наименование пустые, игнорируются. Пример файла импорта:

| Код   | Наименование              | Код ЦФО I | Код родителя |
|-------|---------------------------|-----------|---------------|
| 1000  | Управление проектами      | 1001      |               |
| 1100  | Отдел внедрения           | 1001      | 1000          |
| 1200  | Отдел сопровождения       | 1002      | 1000          |

После успешного импорта новые и обновлённые записи сразу появляются в иерархии БДЗ.
